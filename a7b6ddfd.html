<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Intermediate Representation - My Zettelkasten</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Sudeep" name="author" /><meta content="Trees provide a natural representation of grammatical structure of source code. But their rigid structure makes them less useful for representing other properties of the program." name="description" /><link href="https://sudeepdino008.github.io/a7b6ddfd.html" rel="canonical" /><meta content="Intermediate Representation" property="og:title" /><meta content="My Zettelkasten" property="og:site_name" /><meta content="article" property="og:type" /><meta content="https://sudeepdino008.github.io/static/dependence-graph.png" property="og:image" /><script type="application/ld+json">[{"@context":"https://schema.org","itemListElement":[{"name":"Engineering","item":"https://sudeepdino008.github.io/9cfae20f.html","@type":"ListItem","position":1},{"name":"Computer Science","item":"https://sudeepdino008.github.io/3c5c94e6.html","@type":"ListItem","position":2},{"name":"Compiler notes","item":"https://sudeepdino008.github.io/c9da2f2a.html","@type":"ListItem","position":3}],"@type":"BreadcrumbList"}]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(165,103,63,0.1)}body nav.bottomPane{background-color:rgba(165,103,63,2.0e-2)}body div#footnotes{border-top-color:#a5673f}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#a5673f;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(165,103,63,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><!-- Font  -->
<!-- TODO: neuron has changed default font, remove it later  -->
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&#38;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,600&#38;display=swap" rel="stylesheet">

<!-- mermaidjs -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
window.addEventListener("load", mermaid.initialize({startOnLoad:true}))
</script>

<!-- graphviz -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js" integrity="sha512-vnRdmX8ZxbU+IhA2gLhZqXkX1neJISG10xy0iP0WauuClu3AIMknxyDjYHEpEhi8fTZPyOCWgqUCnEafDB/jVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js" integrity="sha512-1zKK2bG3QY2JaUPpfHZDUMe3dwBwFdCDwXQ01GrKSd+/l0hqPbF+aak66zYPUZtn+o2JYi1mjXAqy5mW04v3iA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  let viz = new Viz();
  for (let element of document.getElementsByClassName("graphviz")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    viz.renderSVGElement(element.textContent)
    .then(function(element) {
      element.setAttribute("width", "100%")
      pparent.replaceChild(element, parent)
    });
  }
});
</script>

<!-- chartjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js" integrity="sha512-SuxO9djzjML6b9w9/I07IWnLnQhgyYVSpHZx0JV97kGBfTIsUYlWflyuW4ypnvhBrslz1yJ3R+S14fdCWmSmSA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  for (let element of document.getElementsByClassName("chartjs")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    let canvas = document.createElement('canvas');
    let box = document.createElement('div');
    box.appendChild(canvas);
    let ctx = canvas.getContext("2d")
    let myChart = new Chart(ctx, JSON.parse(element.textContent));
    box.setAttribute("style","display:block;width:75%;text-align:'center';margin: 5px auto;");
    pparent.replaceChild(box, parent)
  }
});
</script>

<!-- Custom css  -->
<style>

  
img[src$="centerme"] {
  display:block;
  margin: 0 auto;
}

ui.menu {
  font-size: 0.6em;
}

/* tree icon disappear some times*/
body .tree {
  overflow: hidden;
}

/* width */
.ui.text.container {
    min-width: 1000px;
}

@media screen and (min-width: 700px) {
    .ui.attached.segment {
      padding: 50px;
    }
}

* {
  font-size: 17px;
}

body div.zettel-view .zettel-content h1 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

body div.zettel-view .zettel-content h2 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  font-size: 1.75rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}


body div.zettel-view .zettel-content h3 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  font-size: 1.5rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

body div.zettel-view .zettel-content h4 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  font-size: 1.25rem !important;
  padding: 0.3rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

/* title */
#zettel-container > div.zettel-view > article > h1:first-child {
/* body div#neuron-theme-default-black .zettel-content h1 { */
  /* text-align: center !important; */
  font-family: "Crimson Text", serif !important;
  /* font-style: italic; */
  text-align: right;
  font-weight: normal !important;
  font-size: 2rem;
  padding: 1rem;
  /* padding-top: 1rem; */
  /* padding-right: 1rem; */
  /* padding-left: 1rem; */
  background-color: inherit !important;
}

#neuron-theme-default-black > div > h1 {
  font-family: "Crimson Text", serif !important;
  font-weight: normal;
}

/* divider */
.ui.horizontal.divider:before {
  width: 100%;
}

/* logo */
div.ui.one.column.grid.footer-version > div > div > a > img {
  display:none !important;
}

div.ui.one.column.grid.footer-version > div > div > a:before {
  content: "© 2020 shifuda" !important;
  font-size: 0.8rem;
}

/* link */
body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a {
  color: inherit !important;
}

time {
  font-family: "Crimson Text", monospace !important;
}

body code, pre, tt {
  font-family: "Source Code Pro", monospace !important;
}

.ui.text.container {
  font-family: "Crimson Text", serif !important;
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

</style>
<!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-09-24T23:24"><a href="c9da2f2a.html">Compiler notes</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2021-03-19T23:40"><a href="3c5c94e6.html">Computer Science</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-09-24T23:17"><a href="9cfae20f.html">Engineering</a></span></span></div></li></ul></li></ul></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Intermediate Representation</h1><h2 id="introduction">Introduction</h2><ul><li>Natural language has ambiguities. Progamming language shouldn’t have any ambiguity. Ambiguous statements have no meaning.</li><li>interpreters take a executable specification, executes it and returns the output. Compare with compilers, which takes one executable specification and converts to another executable specification.</li><li>mixed modes are there - Java compiles into bytecode, and then this is interpreted by the JVM. For more complicated examples, consider Some implementations of JVM which include a JIT which compiles the bytecode into machine executable instructions at runtime.</li><li>Techniques to analyze whole programs are moving from compilation to linking time, where the entire compiled codebase is available, which opens up new insights which were not present at compile time. Similarly, compiler are being invoked at runtime to generate native instructions with knowledge which were not simply present at compile or link time.</li><li>The optimizers can have several objectives - fast compilation, smaller executable size, lesser page faults, less energy usage.</li><li>optimizations: consists of analysis (if a particular transformation will be ‘efficient’) and transformation. Data flow analysis, reasons the flow of code at runtime.</li><li><em>Instruction selection</em>: maps each IR operations, in its contect, into one or more target machine operations. The IR often assumes infinite registers (virtual registers) and relies on the register allocator to map to actual registers of target machine.<br />Instruction selection can take advantage of special operations on target machine, for example:</li></ul><pre><code class="bash language-bash"># Instruction
a = a * 2

# IR:
load 2 -&gt; r2
load a -&gt; ra
mult ra, r2 -&gt; ra

# can be change to:
load a -&gt; ra
add ra, ra -&gt; ra</code></pre><ul><li>Register allocation: mapping the virtual registers to actual target machine registers. The <span><code class="inline-tag">#registers</code></span> used to execute a set of instructions is to be minimized (although you might used extra registers in case it helps you to reduce <span><code class="inline-tag">#instructions</code></span> or reducing the <span><code class="inline-tag">#cycles</code></span> needed to execute all instructions.)</li><li>Instruction scheduling: Reordering the instructions to execute instructions faster. Many processors have the property to execute new operations while a long-latency operation (like load) executes. Until the paralleling executing instructions depending on the value being loaded, they can execute freely. However, if there’s a dependency, the execution will wait until the long-latency operation completes.<br />As it can be seen there’s a balance to be struck between resgiter allocation and instruction scheduling. This is one of the examples of interactions among code-generation components.</li></ul><h2 id="intermediate-representations">Intermediate Representations</h2><ul><li>Compiler is often arranges as a series of passes. Each pass inputs/outputs some intermediate form with additional information augmented to it (Except the scanner which inputs the source code).</li><li>IR often needs to have more details about the program. They are augmented by various tables that record these additional information. These information will then need to be passed to the next stages of compilation, so that the program can be made better.</li><li>IR can be closer to source code (in source-to-source translators) or closer to asm when you need to output to a particular microprocessor.</li><li>Divided structurally, IR can be Graphical (parse trees, ASTs) or Linear (resembling assembly) or Hybrid (blocks of linear code linked together in a graph indicating flow of control)</li><li>Second axis of the taxonomy is the <em>level of abstraction</em> at which the IR represents the operations. Parse trees for example are much near to the source code. Whereas three-address codes are nearer to assembly.<ul><li>The representation will determine what kind of optimizations are easily possible. For example: Instruction scheduling optimizations are easier in near-assembly IRs, whereas the source-level tree makes it easy to find and compare array references.</li><li>Not all tree-based IRS use a near-source level abstracction. Many C compilers have used low-level expression trees. Similarly many linear IRs can have relatively high-level constructs like min/max/string copy.</li></ul></li><li>The third taxonomy deals with the name space used to represent the values in the code. It has a strong effect on how optimization can improve the code.</li></ul><h3 id="graphical-irs">Graphical IRs</h3><h4 id="syntax-related-trees">Syntax-Related Trees</h4><ul><li>Parse Trees:<br />Think of it as a graphical representation of the parsed statement with intermediate nodes being non-terminal terms from the expression grammer.<br />Many useless nodes are present which do not directly participate in compilation. =&gt; <em>Worth shrinking down.</em></li><li>AST: The parser can build the AST directly.<br />The level of abstractions that ASTs contain depends on the goal of the compiler - Source-to-source systems often use AST from which source code can be easily regenerated. Whereas, if assembly is the aim, the ASTs will contain much lower level info.</li><li>DAG: ASTs with redundancies eliminated. e.g. <code>a X 2 + a X 2 X b</code>, here <code>a X 2</code> is calculated twice. DAG can expose this redundancy. It of course has to prove that the statements are indeed redundant (if the expression don’t contain assignments or function calls etc.).<br />The level of abstraction exposed in a tree matters since compilers can, in general, only perform optimizations using the details exposed by the IR.</li></ul><h4 id="graphs">Graphs</h4><p>Trees provide a natural representation of grammatical structure of source code. But their rigid structure makes them less useful for representing other properties of the program.</p><ul><li><p>Control-Flow Graph</p><ul><li>Basic blocks: a group statements which have no branching. In a CFG, each basic block is a node, and each basic block has either indegree or/and outdegree greater than 1.</li><li>CFG is often used in conjunction with another IR like linear of expression-lvel AST etc (hybrid IR).</li><li>Some recommend using a shorter segment than basic block. A common alternative is <em>single-statement block</em>: block of code corresponding to a single source-level statement.<br />Single statement block would result in more nodes, and so take more space and time to construct and analyze.</li><li>Instruction scheduling uses CFG to find how the scheduled code for individual blocks flows together. Global register allocation relies on a CFG to understand how each operation might execute and where to insert loads and stores for spilled values.</li></ul></li><li><p>Dependence Graph</p></li></ul><p><img src="static/dependence-graph.png" /></p><ul><li><p>Captures the flow from when a variable/register is defined to when it is used. The edges are from “defined”-&gt;“usage” or “usage”-&gt;“usage”</p></li><li><p>Source: You can create a dependence graph from source code or from linear IR.</p></li><li><p>Usages in instruction scheduling and variety of optimizations.</p></li><li><p>Call Graph To address inefficiencies that arise across procedure boundaries, some compilers perform interprocedural analysis and optimizations. A call graph has nodes as procedures and edges as procedure-to-procedure call.<br />Some complications arise:</p><ul><li>Separate compilation (each file or small component is compiled independently) makes it difficult to consider the multiple-file program as a whole. Some compilers build partial graphs and optimize across that set.</li><li>Procedure-valued parameters: When arguments are some lambdas, those might end up calling different functions at different times, which make compile time evaluation difficult.</li><li>OOP with inheritance makes procedure calls ambiguous. Extra type infomration is needed, and in some cases it cannot be known until runtime.</li></ul></li></ul><h3 id="linear-irs">Linear IRs</h3><h3 id="books-used">Books used</h3><ul><li>Engineering a Compiler 2nd Editions (K. Cooper, L. Torczon)</li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2020-09-24T23:24">2020-09-24</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link" title="2020-09-24T23:24"><a href="c9da2f2a.html">Compiler notes</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><span class="zettel-link-container folge"><span class="zettel-link" title="2020-09-24T23:24"><a href="a7b6ddfd.html">Intermediate Representation</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span></div></li></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">cycles</span><span class="ui basic label zettel-tag" title="Tag">instructions</span><span class="ui basic label zettel-tag" title="Tag">registers</span></div></nav><nav class="ui bottom attached icon compact inverted menu brown" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="right item" href="impulse.html" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.27.0" /></a></div></div></div></body></html>