<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Rust - My Zettelkasten</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Sudeep" name="author" /><meta content="z:zettels?tag=rust&amp;limit=15" name="description" /><link href="https://sudeepdino008.github.io/2584752a.html" rel="canonical" /><meta content="Rust" property="og:title" /><meta content="My Zettelkasten" property="og:site_name" /><meta content="article" property="og:type" /><script type="application/ld+json">[]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(165,103,63,0.1)}body nav.bottomPane{background-color:rgba(165,103,63,2.0e-2)}body div#footnotes{border-top-color:#a5673f}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#a5673f;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(165,103,63,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><!-- Font  -->
<!-- TODO: neuron has changed default font, remove it later  -->
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&#38;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,600&#38;display=swap" rel="stylesheet">

<!-- mermaidjs -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
window.addEventListener("load", mermaid.initialize({startOnLoad:true}))
</script>

<!-- graphviz -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js" integrity="sha512-vnRdmX8ZxbU+IhA2gLhZqXkX1neJISG10xy0iP0WauuClu3AIMknxyDjYHEpEhi8fTZPyOCWgqUCnEafDB/jVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js" integrity="sha512-1zKK2bG3QY2JaUPpfHZDUMe3dwBwFdCDwXQ01GrKSd+/l0hqPbF+aak66zYPUZtn+o2JYi1mjXAqy5mW04v3iA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  let viz = new Viz();
  for (let element of document.getElementsByClassName("graphviz")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    viz.renderSVGElement(element.textContent)
    .then(function(element) {
      element.setAttribute("width", "100%")
      pparent.replaceChild(element, parent)
    });
  }
});
</script>

<!-- chartjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js" integrity="sha512-SuxO9djzjML6b9w9/I07IWnLnQhgyYVSpHZx0JV97kGBfTIsUYlWflyuW4ypnvhBrslz1yJ3R+S14fdCWmSmSA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  for (let element of document.getElementsByClassName("chartjs")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    let canvas = document.createElement('canvas');
    let box = document.createElement('div');
    box.appendChild(canvas);
    let ctx = canvas.getContext("2d")
    let myChart = new Chart(ctx, JSON.parse(element.textContent));
    box.setAttribute("style","display:block;width:75%;text-align:'center';margin: 5px auto;");
    pparent.replaceChild(box, parent)
  }
});
</script>

<!-- Custom css  -->
<style>

  
img[src$="centerme"] {
  display:block;
  margin: 0 auto;
}

ui.menu {
  font-size: 0.6em;
}

/* tree icon disappear some times*/
body .tree {
  overflow: hidden;
}

/* width */
.ui.text.container {
    min-width: 1000px;
}

@media screen and (min-width: 700px) {
    .ui.attached.segment {
      padding: 50px;
    }
}

* {
  font-size: 17px;
}

body div.zettel-view .zettel-content h1 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

body div.zettel-view .zettel-content h2 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  font-size: 1.75rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}


body div.zettel-view .zettel-content h3 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  padding: 0.3rem !important;
  font-size: 1.5rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

body div.zettel-view .zettel-content h4 {
  font-family: "Crimson Text", serif !important;
  font-weight: 600 !important;
  font-size: 1.25rem !important;
  padding: 0.3rem !important;
  border-bottom: none;
  text-align: left;
  background-color: inherit !important;
}

/* title */
#zettel-container > div.zettel-view > article > h1:first-child {
/* body div#neuron-theme-default-black .zettel-content h1 { */
  /* text-align: center !important; */
  font-family: "Crimson Text", serif !important;
  /* font-style: italic; */
  text-align: right;
  font-weight: normal !important;
  font-size: 2rem;
  padding: 1rem;
  /* padding-top: 1rem; */
  /* padding-right: 1rem; */
  /* padding-left: 1rem; */
  background-color: inherit !important;
}

#neuron-theme-default-black > div > h1 {
  font-family: "Crimson Text", serif !important;
  font-weight: normal;
}

/* divider */
.ui.horizontal.divider:before {
  width: 100%;
}

/* logo */
div.ui.one.column.grid.footer-version > div > div > a > img {
  display:none !important;
}

div.ui.one.column.grid.footer-version > div > div > a:before {
  content: "© 2020 shifuda" !important;
  font-size: 0.8rem;
}

/* link */
body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a {
  color: inherit !important;
}

time {
  font-family: "Crimson Text", monospace !important;
}

body code, pre, tt {
  font-family: "Source Code Pro", monospace !important;
}

.ui.text.container {
  font-family: "Crimson Text", serif !important;
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

.ui.segment {
    background-color: #fffff0;
}

</style>
<!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Rust</h1><h2 id="index">Index</h2><p><section class="tag-query-results"><div class="ui horizontal divider" title="Neuron TagQuery"><span class="ui basic pointing below black label" title="Zettels tagged &#39;rust&#39;"><i class="tags icon"></i>rust</span></div><div class="ui list listing"><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-27T08:18"><a href="6fd07c2f.html">Rust: Unsafe</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-26T20:23"><a href="b70ab824.html">Rust: Fearless Concurrency</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-26T20:12"><a href="76116dc5.html">Rust: Functional Programming features</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-22T07:04"><a href="48737f93.html">Rust: smart pointers</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-21T12:33"><a href="a46bcfcb.html">Rust: Type system</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-17T20:04"><a href="8591fa18.html">Rust: Generic types, traits and lifetimes</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-16T06:34"><a href="9408ed57.html">Rust: Error handling</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-15T14:14"><a href="21171974.html">Rust: Collections</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-15T12:35"><a href="5e379a83.html">Rust: Module System</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-13T17:14"><a href="4ddbdaa3.html">Rust: Structs</a></span></span></div><div class="item listing-item"><span class="zettel-link-container cf"><span class="zettel-link" title="2021-05-12T08:31"><a href="d5f20757.html">Rust: Ownership</a></span></span></div></div></section></p><pre><code class="bash language-bash">## compile a file
rustc sample.rs &amp;&amp; ./sample
</code></pre><p>Cargo: rust’s build system and package manager</p><pre><code class="bash language-bash">cargo new new_project

cargo build ## just build (and install new dependencies, if there)
cargo run   ## build and run
cargo check ## just check if the code can compile. Faster than cargo build, 
            ## so used in development flow
cargo build --release ## build the release profile
cargo update ## update the dependencies</code></pre><p>Cargo creates a file Cargo.toml which uses TOML as it’s configuration language.</p><ul><li><strong>const</strong> can never be mut, while let variables can be mut. Also, const has to be set to some constant and not a return value from a function. They must always be annotated.</li><li>We can change the type of a variable with shadowing. what’s the use of shadowing?</li><li>scalar types: integer, float, boolean, character</li><li>a char is 4 bytes in size and can store unicode scalar values</li><li>compound data types: tuples and array</li><li>a tuple can be destructured (pattern matching) to get individual elements or simply use tuple.0, tuple.1 etc.</li><li>arrays</li></ul><pre><code class="rust language-rust">// compound: arrays - allocated on stack
let arr: [i32; 5] = [1,2,3,4,5];
let all_3 = [3; 5];</code></pre><ul><li>statements vs expression: the former doesn’t return a value, the later does.</li></ul><pre><code class="rust language-rust">let y = {
    let x = 3;
    x + 1  // no semicolon, adding one makes it a statement and the block won&#39;t return anything
};</code></pre><ul><li>loops and breaks (can return values)</li></ul><pre><code class="rust language-rust">
let mut counter = 0;
let result = loop {
    counter += 1;
    if counter == 10 {
        break counter;
    }
};

println!(&quot;tried {} times&quot;, result);


/// range and iter

for number in (1..4).rev() { println!(&quot;{}!&quot;, number); }  // or (1..=3)
println!(&quot;liftoff!&quot;);</code></pre><ul><li><p>the <strong>prelude</strong>: list of things that Rust automatically imports into every rust program.</p></li><li><p><strong>String</strong> type: UTF-8 encoded bit of string</p></li><li><p>generate random number:</p></li></ul><pre><code class="rust language-rust">use rand::Rng;
let secret_num = rand::thread_rng().gen_range(1..101);</code></pre><ul><li>view doc of a cargo project and all dependencies: <code>cargo doc --open</code></li></ul><h2 id="enums">Enums</h2><pre><code class="rust language-rust">
#[derive(Debug)]
    enum Color {
        Black(i32),
        Rest { r: i32, g: i32, b: i32 },
    }</code></pre><ul><li>we can define functions for enums as well (just like structs using <code>impl</code>).</li><li>rust uses <code>Option</code> to handle “something or nothing” aspect of enums or other types:</li></ul><pre><code class="rust language-rust">enum Option&lt;T&gt; {
    Some(T),
    None,
}</code></pre><h2 id="matching">matching</h2><pre><code class="rust language-rust">let colorblind: Option&lt;Color&gt; = Some(green);

match colorblind {
    Some(c) =&gt; {
        println!(&quot;color is {:?}&quot;, c);
        c
    },
    None =&gt; {
        println!(&quot;I&#39;m color blind all right!&quot;);
        Color::Blind
    }
}</code></pre><ul><li><p>matches are exhaustive</p></li><li><p>there is a special pattern <code>_</code> which can match any value</p></li><li><p><code>if let</code> can be used as a syntactic sugar for cases where you just need to deal with one value of the enum.</p></li><li><p>matching in the above form causes ownership transfer. We can use reference borrowing here.</p></li></ul><pre><code class="rust language-rust">match colorblind {
    Some(ref c) =&gt; {
        println!(&quot;1: color is {:?}&quot;, c);
    },
    None =&gt; {
        println!(&quot;I&#39;m color blind all right!&quot;);
    }
}

match &amp;colorblind {
    Some(c) =&gt; {
        println!(&quot;2: color is {:?}&quot;, c);
    },
    None =&gt; {
        println!(&quot;I&#39;m color blind all right!&quot;);
    }
}</code></pre><p>Also see <a href="https://samliu.github.io/2017/02/19/rust-borrowing-in-match.html">here</a></p><h2 id="rustic-emacs-mode-setup">Rustic emacs mode setup</h2><p><code>s-l h h</code> : show documentation of symbol under point<br /><code>M-j</code> to outline the current module for quickly navigating between functions<br /><code>s-l r r</code> : lsp-rename : useful for refactoring a symbol under point <code>M-.</code>: goto implementation for the symbol under point; <code>M-,</code> to jump back <code>M-?</code>: find usages of a function <code>C-c C-c C-l</code>: rustic-cargo-clippy : run rust linter <code>C-c C-c C-k</code>: cargo check - faster than cargo build <code>C-c C-c C-b</code>: cargo build <code>C-c C-c C-r</code>: cargo run <code>S-o</code>: to open file in current project <code>C-x p p</code>: projectile-switch-project <code>C-x p k</code>: projectile-kill-buffers : kill all buffers from the current project</p><p><code>lsp-ui-peek-find-definitions</code> and <code>lsp-ui-peek-find-references</code>: in general <code>lsp-ui-peek</code> <code>C-#</code>: find documentation for a key <code>S-k</code>: kill current buffer <code>S-s</code> : switch persp</p><h2 id="rust-testing">rust testing</h2><ul><li><code>test</code> attribute (metadata about pieces of rust code)</li></ul><pre><code class="rust language-rust">#[cfg(test)]
mod tests {
    #[test]
    fn it_works() {
        assert_eq!(2 + 2, 4);
        assert!(true);
        assert_ne!(1, 2);
        panic!(&quot;assert_eq calls this in case of fail.&quot;)
    }
}</code></pre><ul><li><code>cargo test</code> to run the tests. By default runs these test in parallel.<br /><code>cargo test -- --test-threads=1</code> for sequential execution.<br /><code>cargo test -- --show-output</code> to show the output of <code>println!</code>, which is not showed by default.<br /><code>cargo test &lt;substring&gt;</code>: runs the tests whose name matches the substring.</li><li>benchmark tests are there for measuring performance</li><li><code>Doc-tests adder</code>: run the code examples in the documentation to make sure it is in sync with the code!</li><li><code>should_panic</code> attribute to check that the test should panic. This is often imprecise on it’s own because code can panic anywhere, so you can add the message that the expected panic would show:</li></ul><pre><code class="rust language-rust">
#[test]
#[should_panic(expected = &quot;assert_eq calls this in case of fail.&quot;)]
fn it_works() {
//
}</code></pre><ul><li><p>another way to write tests is by returning <code>Result&lt;(), String&gt;</code>: this allows you to use the <code>?</code> operator which is convenient.</p></li><li><p><code>ignore</code> attribute can skip some tests. You can also invert the execution and just run ignored tests: <code>cargo test -- --ignored</code></p></li><li><p>unit tests: create a <code>tests</code> module in each file to contain the test functions.</p></li><li><p>integrations tests</p><ul><li>seems to only work for library crates. Binary crates cannot be called from outside, which is what is needed for integration tests.</li><li>created in <code>tests</code> directory parallel to src. Each files in tests gets compiles as a separate crate. If you want to have some utils modules in tests, create it in <code>tests/common/</code> directory, and rust can ignore it.</li></ul></li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2021-05-16T20:56">2021-05-16</time></div></div></article><nav class="ui bottom attached icon compact inverted menu brown" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="right item" href="impulse.html" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.27.0" /></a></div></div></div></body></html>